<div class="kanban-layout">
  <mat-sidenav-container class="sidenav-container w-100">
    <mat-sidenav mode="side" opened>
      <img class="p-3 pt-4 mt-2 d-flex mx-auto" width="50%" src="assets/img/ordore.png" />
      <mat-nav-list class="mx-2">
        <mat-list-item class="mt-2" (click)="activeView = 'orders'" [class.active]="activeView === 'orders'">
          <mat-icon>assignment</mat-icon> Manage Orders
        </mat-list-item>
        <mat-list-item class="mt-2" (click)="activeView = 'menu'" [class.active]="activeView === 'menu'">
          <mat-icon>restaurant_menu</mat-icon>Manage Stocks
        </mat-list-item>
      </mat-nav-list>
    </mat-sidenav>
    <mat-sidenav-content>
      <div *ngIf="activeView === 'orders'">
        <div class="headers d-flex align-items-center justify-content-between">
          <h2 class="m-0">Hello Chef</h2>
          <div class="d-flex align-items-center">
            <mat-button-toggle-group [(ngModel)]="viewMode" class="mr-3" (change)="onViewModeChange($event.value)">
              <mat-button-toggle value="kanban">Kanban View</mat-button-toggle>
              <mat-button-toggle value="itemType">Item View</mat-button-toggle>
            </mat-button-toggle-group>
            
            <button (click)="logout()" class="ms-3 lgout-button" mat-raised-button color="warn">Logout</button>
          </div>
        </div>
        <div *ngIf="viewMode === 'kanban'" class="kanban-board">
          <div cdkDropListGroup class="board-columns">
            <div *ngFor="let status of orderStatuses" class="column">
              <h3 class="text-center m-3">{{ status | titlecase }}</h3>
              <div cdkDropList [id]="'orders-' + status" [cdkDropListData]="ordersByStatus[status]"
                (cdkDropListDropped)="drop($event)" class="order-list">
                <div *ngFor="let order of ordersByStatus[status]" cdkDrag [cdkDragData]="order" [ngClass]="status" class="order-item">
                  <ul>
                    <li *ngFor="let item of order.items">
                      {{ item.quantity }} - {{ item.name }}
                    </li>
                  </ul>
                  <p class="m-0">Orders from table: {{ order.tableNumber }}</p>
                  <p class="m-0">Orders from Person: {{ order.customerName }}</p>
                  <p class="m-0">Ordered On: {{ order.createdAt | date:'short' }}</p>
                  
                  <button *ngIf="status === 'completed'" 
                          (click)="deleteOrder(order._id)" 
                          class="btn btn-danger btn-sm mt-2">
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Item Type View -->
        <div *ngIf="viewMode === 'itemType'" class="item-type-view p-4">
          <table mat-table [dataSource]="items">
        
            <!-- Category Column -->
            <ng-container matColumnDef="category">
              <th mat-header-cell *matHeaderCellDef> Category </th>
              <td mat-cell *matCellDef="let item"> {{ item.category }} </td>
            </ng-container>
        
            <!-- Item Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef> Item </th>
              <td mat-cell *matCellDef="let item"> {{ item.name }} </td>
            </ng-container>
        
            <!-- Quantity Column -->
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef> Quantity </th>
              <td mat-cell *matCellDef="let item"> {{ item.totalQuantity }} </td>
            </ng-container>
        
            <!-- Table Numbers Column -->
            <ng-container matColumnDef="tables">
              <th mat-header-cell *matHeaderCellDef> Table Numbers </th>
              <td mat-cell *matCellDef="let item">
                <span *ngFor="let table of item.tables">
                  {{ table.tableNumber }} ({{ table.quantity }}),
                </span>
              </td>
            </ng-container>
        
            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> Status </th>
              <td mat-cell *matCellDef="let item">
                <mat-select [(ngModel)]="item.status" (selectionChange)="updateOrderStatus(item.orderId, $event.value)">
                  <mat-option *ngFor="let status of orderStatuses" [value]="status">
                    {{ status }}
                  </mat-option>
                </mat-select>
              </td>
            </ng-container>
            
        
            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let item">
                <button class="mt-3 mb-3" mat-stroked-button color="primary" 
                        (click)="updateOrderStatus(item.orderId, 'preparing')" 
                        *ngIf="item.status === 'pending'">Start Preparing</button>
                <button class="mt-3 mb-3 text-success" mat-stroked-button 
                        (click)="updateOrderStatus(item.orderId, 'ready')" 
                        *ngIf="item.status === 'preparing'">Mark as Ready</button>
              </td>
            </ng-container>
        
            <!-- Header and Row Definitions -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
        
        
      </div>
      <div *ngIf="activeView === 'menu'">
        <div class="headers d-flex align-items-center justify-content-between">
          <h2 class="m-0">Hello Chef</h2>
          <button (click)="logout()" class="lgout-button" mat-raised-button color="warn">Logout</button>
        </div>
        <mat-accordion multi="true" class="menu-categories">
          <mat-expansion-panel *ngFor="let category of getUniqueCategories()" [expanded]="true">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3 class="m-0">{{ category }}</h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="menu-items row">
              <ng-container *ngFor="let item of (menuItems$ | async)">
                <mat-card class="col-2" *ngIf="item.category.name === category">
                  <img *ngIf="item.imageUrl" class="img-fluid" [src]="getImageUrl(item.imageUrl)" [alt]="item.name">
                  <mat-card-header class="px-0">
                    <mat-card-title>{{ item.name }}</mat-card-title>
                    <mat-card-subtitle>{{ item.category }}</mat-card-subtitle>
                  </mat-card-header>
                  <mat-card-content class="px-0">
                    <p>{{ item.description }}</p>
                    <p><strong>Price: {{ item.price | currency }}</strong></p>
                    <mat-slide-toggle
                      [checked]="item.isInStock"
                      (change)="toggleStockStatus(item)">
                      {{ item.isInStock ? 'In Stock' : 'Out of Stock' }}
                    </mat-slide-toggle>
                  </mat-card-content>
                </mat-card>
              </ng-container>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>